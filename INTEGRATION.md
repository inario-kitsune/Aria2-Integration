# ArcUI ä¸æ‰©å±•é›†æˆè¯´æ˜

## é›†æˆå®Œæˆ âœ…

ArcUI ç°å·²å®Œå…¨é›†æˆåˆ° Aria2-Integration æµè§ˆå™¨æ‰©å±•ä¸­ï¼Œæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š

### ğŸ”— æ ¸å¿ƒé›†æˆ

1. **è‡ªåŠ¨é…ç½®è¯»å–**
   - ä»æ‰©å±•å­˜å‚¨è¯»å– RPC æœåŠ¡å™¨é…ç½®ï¼ˆ`rpcServers`ï¼‰
   - è‡ªåŠ¨ä½¿ç”¨é»˜è®¤æœåŠ¡å™¨ï¼ˆ`defaultServerId`ï¼‰
   - æ”¯æŒå¤šæœåŠ¡å™¨é…ç½®åˆ‡æ¢

2. **æ™ºèƒ½é™çº§**
   - åœ¨æ‰©å±•ç¯å¢ƒä¸­ï¼šè‡ªåŠ¨è¯»å–æ‰©å±•é…ç½®
   - åœ¨ç‹¬ç«‹ç¯å¢ƒä¸­ï¼šä½¿ç”¨é»˜è®¤ localhost é…ç½®
   - æ— ç¼æ”¯æŒä¸¤ç§ä½¿ç”¨åœºæ™¯

3. **é…ç½®ç®¡ç†**
   - æ–°å¢æœåŠ¡å™¨è®¾ç½®å¯¹è¯æ¡† (âš™ï¸ æŒ‰é’®)
   - æ”¯æŒä¿®æ”¹åè®®ã€ä¸»æœºã€ç«¯å£ã€è·¯å¾„ã€å¯†é’¥
   - ä¿å­˜åè‡ªåŠ¨æµ‹è¯•è¿æ¥
   - å®æ—¶åé¦ˆè¿æ¥çŠ¶æ€

### ğŸ“ æ–‡ä»¶ç»“æ„

```
webui/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AddDownload.svelte    # æ·»åŠ ä¸‹è½½å¯¹è¯æ¡†
â”‚   â”œâ”€â”€ DownloadItem.svelte   # ä¸‹è½½é¡¹å¡ç‰‡
â”‚   â”œâ”€â”€ DownloadList.svelte   # ä¸‹è½½åˆ—è¡¨
â”‚   â”œâ”€â”€ Settings.svelte       # æœåŠ¡å™¨è®¾ç½®å¯¹è¯æ¡† (æ–°å¢)
â”‚   â””â”€â”€ Stats.svelte          # ç»Ÿè®¡ä¿¡æ¯
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ aria2-client.js       # Aria2 JSON-RPC å®¢æˆ·ç«¯
â”‚   â””â”€â”€ i18n.js              # å›½é™…åŒ–ç³»ç»Ÿ
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ client.js            # å®¢æˆ·ç«¯çŠ¶æ€
â”‚   â”œâ”€â”€ downloads.js         # ä¸‹è½½åˆ—è¡¨çŠ¶æ€
â”‚   â””â”€â”€ stats.js            # ç»Ÿè®¡ä¿¡æ¯çŠ¶æ€
â””â”€â”€ App.svelte              # æ ¹ç»„ä»¶
```

### ğŸ¯ ä½¿ç”¨æ–¹å¼

#### åœ¨æ‰©å±•ä¸­ä½¿ç”¨

1. ç‚¹å‡»æ‰©å±•å›¾æ ‡æ‰“å¼€ popup
2. ç‚¹å‡» "Web UI" æŒ‰é’®
3. ArcUI è‡ªåŠ¨è¯»å–æ‰©å±•ä¸­é…ç½®çš„ RPC æœåŠ¡å™¨
4. è‡ªåŠ¨è¿æ¥åˆ°é»˜è®¤æœåŠ¡å™¨

#### ç‹¬ç«‹ä½¿ç”¨

1. è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼š
   ```bash
   cd webui
   pnpm run dev
   ```

2. è®¿é—® `http://localhost:5173`

3. é¦–æ¬¡ä½¿ç”¨æ—¶ï¼š
   - ç‚¹å‡»å³ä¸Šè§’ âš™ï¸ æŒ‰é’®
   - é…ç½® Aria2 RPC æœåŠ¡å™¨ä¿¡æ¯
   - ç‚¹å‡»"ä¿å­˜å¹¶è¿æ¥"

### ğŸ”§ é…ç½®é¡¹è¯´æ˜

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| Protocol | è¿æ¥åè®® | ws, wss, http, https |
| Host | Aria2 ä¸»æœºåœ°å€ | 127.0.0.1, example.com |
| Port | RPC ç«¯å£ | 6800 |
| Path | RPC è·¯å¾„ | jsonrpc |
| Secret Token | RPC å¯†é’¥ï¼ˆå¯é€‰ï¼‰ | mysecret |

### ğŸŒ å¤šè¯­è¨€æ”¯æŒ

æ‰€æœ‰ç•Œé¢å…ƒç´ å‡å·²ç¿»è¯‘ä¸º 4 ç§è¯­è¨€ï¼š

- **English** - è‹±è¯­
- **ç®€ä½“ä¸­æ–‡** - Simplified Chinese
- **ç¹é«”ä¸­æ–‡** - Traditional Chinese
- **æ—¥æœ¬èª** - Japanese

é€šè¿‡å³ä¸Šè§’ ğŸŒ æŒ‰é’®åˆ‡æ¢è¯­è¨€ï¼Œé€‰æ‹©ä¼šä¿å­˜åˆ° localStorageã€‚

### ğŸ“¦ æ„å»ºäº§ç‰©

```
dist/data/webui/
â”œâ”€â”€ index.html     # å…¥å£ HTML (0.34 kB)
â”œâ”€â”€ webui.css      # æ ·å¼æ–‡ä»¶ (12.58 kB, gzip: 2.49 kB)
â””â”€â”€ webui.js       # JavaScript (45.59 kB, gzip: 15.29 kB)

æ€»è®¡: ~18 kB (gzipped)
```

### ğŸ”„ é…ç½®åŒæ­¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰©å±•é…ç½®é¡µé¢     â”‚
â”‚ (options/rpc.js) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ä¿å­˜é…ç½®
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ browser.storage  â”‚
â”‚  - rpcServers   â”‚
â”‚  - defaultServerId â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ è¯»å–é…ç½®
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ArcUI        â”‚
â”‚  (App.svelte)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ åˆå§‹åŒ–å®¢æˆ·ç«¯
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Aria2Client    â”‚
â”‚   è¿æ¥æœåŠ¡å™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš¡ æ€§èƒ½ä¼˜åŒ–

1. **æŒ‰éœ€åŠ è½½**
   - è®¾ç½®å¯¹è¯æ¡†ä»…åœ¨ç‚¹å‡»æ—¶åŠ è½½
   - è¯­è¨€èœå•æŒ‰éœ€æ˜¾ç¤º

2. **æ™ºèƒ½è½®è¯¢**
   - ç»Ÿè®¡ä¿¡æ¯æ¯ 1 ç§’æ›´æ–°
   - ä¸‹è½½åˆ—è¡¨æ¯ 1 ç§’åˆ·æ–°
   - ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢è½®è¯¢

3. **æœ€å°åŒ–æ‰“åŒ…**
   - ä½¿ç”¨ Vite è¿›è¡Œä»£ç åˆ†å‰²
   - CSS å’Œ JS åˆ†ç¦»
   - Gzip å‹ç¼©åä»… 18KB

### ğŸ›¡ï¸ å®‰å…¨æ€§

1. **æ—  CSP é—®é¢˜**
   - ä¸ä½¿ç”¨ `eval` æˆ– `Function` æ„é€ å™¨
   - ä¸éœ€è¦ `unsafe-eval` CSP æŒ‡ä»¤
   - é€‚åˆä¸¥æ ¼çš„å®‰å…¨ç­–ç•¥

2. **å¯†é’¥ä¿æŠ¤**
   - RPC å¯†é’¥å­˜å‚¨åœ¨æ‰©å±• storageï¼ˆåŠ å¯†ï¼‰
   - ç‹¬ç«‹æ¨¡å¼ä¸‹å¯ä½¿ç”¨å¯†ç è¾“å…¥æ¡†
   - ä¸åœ¨ URL ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯

3. **è¿æ¥éªŒè¯**
   - ä¿å­˜è®¾ç½®å‰æµ‹è¯•è¿æ¥
   - å®æ—¶æ˜¾ç¤ºè¿æ¥çŠ¶æ€
   - è¿æ¥å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### ğŸ› è°ƒè¯•

å¼€å¯æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—ï¼š

```javascript
// åˆå§‹åŒ–ä¿¡æ¯
"Aria2 client initialized"

// è¿æ¥æˆåŠŸ
"Connected to Aria2"

// è¿æ¥å¤±è´¥
"Failed to initialize Aria2 client: ..."

// é…ç½®è¯»å–
"Browser storage not available" (ç‹¬ç«‹æ¨¡å¼)
```

### ğŸ”® æœªæ¥æ”¹è¿›

- [ ] æ”¯æŒå¤šæœåŠ¡å™¨åˆ‡æ¢ï¼ˆä¸‹æ‹‰èœå•ï¼‰
- [ ] é…ç½®å¯¼å…¥/å¯¼å‡º
- [ ] è¿æ¥çŠ¶æ€æŒä¹…åŒ–
- [ ] ç¦»çº¿æ¨¡å¼æ”¯æŒ
- [ ] WebSocket é‡è¿æœºåˆ¶ä¼˜åŒ–
- [ ] æ›´è¯¦ç»†çš„é”™è¯¯æç¤º

---

## æŠ€æœ¯ç»†èŠ‚

### é…ç½®è¯»å–é€»è¾‘

```javascript
// App.svelte
onMount(async () => {
  let serverConfig = null;

  // å°è¯•ä»æ‰©å±•å­˜å‚¨è¯»å–
  if (typeof browser !== 'undefined' && browser.storage) {
    const storage = await browser.storage.local.get(['rpcServers', 'defaultServerId']);
    const servers = JSON.parse(storage.rpcServers || "[]");
    
    if (servers.length > 0) {
      const defaultServer = servers.find(s => s.id === storage.defaultServerId) || servers[0];
      serverConfig = {
        protocol: defaultServer.protocol,
        host: defaultServer.host,
        port: defaultServer.port,
        path: defaultServer.interf,
        secret: defaultServer.token
      };
    }
  }

  // é™çº§åˆ°é»˜è®¤é…ç½®
  if (!serverConfig) {
    serverConfig = {
      protocol: "ws",
      host: "127.0.0.1",
      port: "6800",
      path: "jsonrpc",
      secret: ""
    };
  }

  // åˆå§‹åŒ–å¹¶è¿æ¥
  aria2Client.initialize(serverConfig);
  await aria2Client.connect();
});
```

### æ‰©å±•å­˜å‚¨æ ¼å¼

```json
{
  "rpcServers": "[{\"id\":\"xxx\",\"name\":\"Local\",\"protocol\":\"ws\",\"host\":\"127.0.0.1\",\"port\":\"6800\",\"interf\":\"jsonrpc\",\"token\":\"\"}]",
  "defaultServerId": "xxx"
}
```

### ç‹¬ç«‹é…ç½®å­˜å‚¨

ç‹¬ç«‹æ¨¡å¼ä¸‹ï¼Œé…ç½®ä»…åœ¨è¿è¡Œæ—¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé¡µé¢åˆ·æ–°åéœ€è¦é‡æ–°é…ç½®ã€‚æœªæ¥å¯ä»¥æ·»åŠ  localStorage æŒä¹…åŒ–ã€‚

---

**é›†æˆå®Œæˆæ—¶é—´**: 2025-11-25  
**ç‰ˆæœ¬**: ArcUI 0.1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
